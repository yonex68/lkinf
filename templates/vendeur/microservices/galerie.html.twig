{% extends 'vendeur.html.twig' %}

{% block title %}Galérie{% endblock %}

{% block colleft %}4{% endblock %}

{% block colright %}8{% endblock %}

{% block sidebar %}
	{% include "vendeur/microservices/composants/_step.html.twig" %}
{% endblock %}

{% block body %}

<div class="p-3 border-bottom text-left bg-dark rounded">
    <h4 class="mb-0 text-light">
        Nouveau service
    </h4>
</div>

<div class="p-3 border-bottom">
    {{ form_start(form) }}
    <div class="form-group">
        <h6 class="font-weight-bold">Galerie</h6>
        <p class="text-muted">
            La 1re image, principale, sera utilisée dans la recherche, les catégories, et sur votre profil. C’est la plus importante. Afin que votre service se démarque des autres, privilégiez une miniature lisible en format réduit, en rapport direct avec ce que vous faites dans votre service basique, et surtout : de votre création. <br>

            Les autres images, optionnelles, serviront à montrer des exemples de votre travail ou illustrer plus précisément ce que vous vendez. Vous pouvez également joindre une vidéo que vous aurez hébergée sur YouTube ou Vimeo.
        </p>
        <div class="">
            <div id="media" data-prototype="{{ form_row(form.medias.vars.prototype)|e('html_attr') }}">
                {{ form_row(form.medias) }}
                <span></span>
            </div>
        </div>
    </div>
    <div class="">
        <div class="">
            <button class="btn btn-dark">{{ button_label|default('Enregistrer et suivant') }}</button>
        </div>
    </div>

    {{ form_end(form) }}
</div>

{% endblock %}

{% block javascripts %}

{{ parent() }}

<script>
    let collection,
        boutonAjout,
        span;
    window.onload = () => {
        collection = document.querySelector("#media");
        span = collection.querySelector("span");

        boutonAjout = document.createElement("button");
        boutonAjout.className = "ajout-media ajout-prix btn btn-dark mb-4";
        boutonAjout.innerText = "Ajouter une image";

        let nouveauBouton = span.append(boutonAjout);

        collection.dataset.index = collection.querySelectorAll("input").length;

        boutonAjout.addEventListener("click", function () {
            addButton(collection, nouveauBouton);
        });
    }

    function addButton(collection, nouveauBouton) {
        let prototype = collection.dataset.prototype;

        let index = collection.dataset.index;

        prototype = prototype.replace(/__name__/g, index);

        let content = document.createElement("html");
        content.innerHTML = prototype;
        let newForm = content.querySelector("div");

        let boutonSuppr = document.createElement("button");
        boutonSuppr.type = "button";
        boutonSuppr.className = "btn btn-danger mb-3";
        boutonSuppr.id = "delete-media-" + index;
        boutonSuppr.innerText = "Supprimer";

        newForm.append(boutonSuppr);

        collection.dataset.index++;

        let boutonAjout = collection.querySelector(".ajout-media");

        span.insertBefore(newForm, boutonAjout);

        boutonSuppr.addEventListener("click", function () {
            this.previousElementSibling.parentElement.remove();
        })
    }
</script>

{% endblock %}